# BA竞技场排名监控插件# BA竞技场排名监控插件



这是一个用于AstrBot的Blue Archive (BA) 竞技场排名监控插件。它提供了便捷的命令式操作来监控玩家竞技场排名变化。这是一个用于AstrBot的Blue Archive (BA) 竞技场排名监控插件。它可以定期检查玩家的竞技场排名，当排名发生变化时自动发送通知。



## 功能特点## 功能特点



- 🔄 自动每5分钟检查一次竞技场排名- 🔄 自动每5分钟检查一次竞技场排名

- 📈 检测排名变化并发送通知到原会话- 📈 检测排名变化并发送通知

- 💾 本地存储监控配置和历史数据- 💾 本地存储历史排名数据

- 👥 支持多用户同时使用- ⚙️ 可配置的服务器和通知设置

- 🎯 命令式操作，无需配置文件- 🛠️ 提供手动测试和管理指令

- 🔧 支持监控状态查看和管理

## 配置说明

## 使用指令

在AstrBot的WebUI插件管理中配置以下参数：

### 启动监控

```### 必填配置

/ba监控 [服务器] [好友码]- `notice_id`: 要接收通知的QQ号

```- `friend_code`: 游戏好友码

示例：`/ba监控 TW ABCDEFGH`

### 可选配置  

### 取消监控- `server`: 服务器选择，可选值：`TW`, `NA`, `AS`, `KR`, `GL`（默认：`TW`）

```

/ba取消监控## 使用指令

```

| 指令 | 说明 |

### 查看监控状态|------|------|

```| `/ba_pvp_status` | 查看插件运行状态和配置信息 |

/ba监控状态| `/ba_pvp_test` | 手动测试获取当前排名数据 |

```| `/ba_pvp_force_update` | 强制更新当前排名为基准值 |



### 获取帮助## 工作原理

```

/ba监控1. **初始化**: 插件启动时检查`notice_id`和`friend_code`是否配置

```2. **定时监控**: 每5分钟调用BA竞技场API获取最新排名

（不提供参数时显示完整使用说明）3. **变化检测**: 比较当前排名与上次记录的排名

4. **发送通知**: 如果排名发生变化，向配置的QQ号发送通知消息

## 支持的服务器5. **数据持久化**: 将最新排名保存到本地文件



- `TW` - 台湾服## 通知格式

- `NA` - 北美服

- `AS` - 亚洲服当排名发生变化时，会收到如下格式的通知：

- `KR` - 韩国服

- `GL` - 国际服```

📈 BA竞技场排名变化通知

## 工作原理服务器: TW

排名上升: 1500 → 1450

1. **命令启动**: 用户通过 `/ba监控` 命令启动监控变化: 50 位

2. **好友码验证**: 验证好友码有效性并获取当前排名```

3. **后台监控**: 每5分钟调用BA竞技场API获取最新排名

4. **变化检测**: 比较当前排名与上次记录的排名## 数据存储

5. **会话通知**: 排名变化时在启动监控的会话中发送通知

6. **数据持久化**: 自动保存监控配置，支持插件重启恢复插件会在`data/ba_pvp_data.json`文件中保存历史排名数据，包括：

- `last_arena_ranking`: 上次记录的排名

## 通知格式- `last_update`: 最后更新时间



当排名发生变化时，会在原会话收到如下格式的通知：## 注意事项



```- 需要玩家游戏在线时API才会返回最新数据

📈 BA竞技场排名变化通知- 如果`notice_id`或`friend_code`为空，插件不会启动监控功能

服务器: TW- 网络异常时插件会自动重试，等待1分钟后继续监控

排名上升: 1500 → 1450- 插件重载或停止时会自动取消监控任务

变化: 50 位

```## 依赖



## 数据存储- `aiohttp>=3.8.0`: 用于异步HTTP请求



插件会在`data/ba_pvp_monitors.json`文件中保存所有用户的监控配置：## API来源

- 用户会话标识

- 服务器代码本插件使用 [bacrawl.diyigemt.com](https://bacrawl.diyigemt.com) 提供的API服务。

- 好友码

- 最后记录的排名# 支持

- 最后更新时间

[AstrBot帮助文档](https://astrbot.app)

## 特性说明

- **多用户支持**: 每个用户可以独立设置和管理自己的监控
- **会话绑定**: 通知消息发送到启动监控的原会话中
- **自动恢复**: 插件重启后会自动恢复之前的监控任务
- **错误处理**: API请求失败时会自动重试
- **状态管理**: 提供完整的监控状态查看功能

## 注意事项

- 每个用户只能同时监控一个账号
- 如果要更换监控目标，需要先取消当前监控
- 需要玩家游戏在线时API才会返回最新数据
- 网络异常时插件会自动重试，等待1分钟后继续监控
- 插件支持跨会话重启恢复监控任务

## 依赖

- `aiohttp>=3.8.0`: 用于异步HTTP请求

## API来源

本插件使用 [bacrawl.diyigemt.com](https://bacrawl.diyigemt.com) 提供的API服务。

## 支持

[AstrBot帮助文档](https://astrbot.app)