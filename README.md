# BA竞技场排名监控插件

这是一个用于AstrBot的Blue Archive (BA) 竞技场排名监控插件。它可以定期检查玩家的竞技场排名，当排名发生变化时自动发送通知。

## 功能特点

- 🔄 自动每5分钟检查一次竞技场排名
- 📈 检测排名变化并发送通知
- 💾 本地存储历史排名数据
- ⚙️ 可配置的服务器和通知设置
- 🛠️ 提供手动测试和管理指令

## 配置说明

在AstrBot的WebUI插件管理中配置以下参数：

### 必填配置
- `notice_id`: 要接收通知的QQ号
- `friend_code`: 游戏好友码

### 可选配置  
- `server`: 服务器选择，可选值：`TW`, `NA`, `AS`, `KR`, `GL`（默认：`TW`）

## 使用指令

| 指令 | 说明 |
|------|------|
| `/ba_pvp_status` | 查看插件运行状态和配置信息 |
| `/ba_pvp_test` | 手动测试获取当前排名数据 |
| `/ba_pvp_force_update` | 强制更新当前排名为基准值 |

## 工作原理

1. **初始化**: 插件启动时检查`notice_id`和`friend_code`是否配置
2. **定时监控**: 每5分钟调用BA竞技场API获取最新排名
3. **变化检测**: 比较当前排名与上次记录的排名
4. **发送通知**: 如果排名发生变化，向配置的QQ号发送通知消息
5. **数据持久化**: 将最新排名保存到本地文件

## 通知格式

当排名发生变化时，会收到如下格式的通知：

```
📈 BA竞技场排名变化通知
服务器: TW
排名上升: 1500 → 1450
变化: 50 位
```

## 数据存储

插件会在`data/ba_pvp_data.json`文件中保存历史排名数据，包括：
- `last_arena_ranking`: 上次记录的排名
- `last_update`: 最后更新时间

## 注意事项

- 需要玩家游戏在线时API才会返回最新数据
- 如果`notice_id`或`friend_code`为空，插件不会启动监控功能
- 网络异常时插件会自动重试，等待1分钟后继续监控
- 插件重载或停止时会自动取消监控任务

## 依赖

- `aiohttp>=3.8.0`: 用于异步HTTP请求

## API来源

本插件使用 [bacrawl.diyigemt.com](https://bacrawl.diyigemt.com) 提供的API服务。

# 支持

[AstrBot帮助文档](https://astrbot.app)
